<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MicroFilter Lab - ë¯¸ì„¸í•„í„° ì‹¤í—˜ ë°ì´í„° ê¸°ë¡</title>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(to bottom right, #f0f6ff, #ffffff);
      color: #333;
    }
    header {
      background-color: #0077b6;
      color: white;
      text-align: center;
      padding: 1.5rem 0;
      font-size: 1.6rem;
      font-weight: bold;
      letter-spacing: 1px;
    }
    main {
      max-width: 900px;
      margin: 30px auto;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      padding: 20px 40px;
    }
    section {
      margin-bottom: 30px;
    }
    h2 {
      border-left: 5px solid #0077b6;
      padding-left: 10px;
      color: #023e8a;
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: 600;
    }
    input, select {
      margin-top: 5px;
      padding: 8px;
      width: 100%;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    button {
      margin-top: 15px;
      padding: 10px 20px;
      border: none;
      background-color: #0077b6;
      color: white;
      font-weight: bold;
      border-radius: 6px;
      cursor: pointer;
      transition: 0.2s;
    }
    button:hover {
      background-color: #023e8a;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      text-align: center;
      padding: 8px;
    }
    th {
      background-color: #caf0f8;
    }
    #chartContainer {
      margin-top: 40px;
    }
    #imagePreview {
      margin-top: 15px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    #imagePreview img {
      width: 120px;
      height: 120px;
      object-fit: cover;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    footer {
      text-align: center;
      font-size: 0.9rem;
      color: #777;
      padding: 15px 0;
    }
  </style>
</head>
<body>
  <header>ğŸ§ª MicroFilter Lab: ë¯¸ì„¸í•„í„° ì‹¤í—˜ ë°ì´í„° ê¸°ë¡</header>

  <main>
    <section id="intro">
      <h2>ì‹¤í—˜ ê°œìš”</h2>
      <p>
        ì´ í˜ì´ì§€ëŠ” ê³ ë“±í•™ìƒ ìˆ˜ì¤€ì˜ ì‹¤í—˜ ë°ì´í„°ë¥¼ ì²´ê³„ì ìœ¼ë¡œ ê¸°ë¡í•˜ê³  ë¶„ì„í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.<br>
        ë¯¸ì„¸í”Œë¼ìŠ¤í‹± ì œê±° íš¨ìœ¨, í•„í„° ì¬ì§ˆ, ì‹œê°„ë³„ ë³€í™”ë¥¼ ì…ë ¥í•˜ê³  ì‹œê°í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      </p>
    </section>

    <section id="dataInput">
      <h2>ë°ì´í„° ì…ë ¥</h2>
      <label>ë‚ ì§œ</label>
      <input type="date" id="dateInput">
      
      <label>í•„í„° ì¬ì§ˆ</label>
      <select id="filterType">
        <option value="ë¶€ì§í¬">ë¶€ì§í¬</option>
        <option value="í™œì„±íƒ„">í™œì„±íƒ„</option>
        <option value="ëª¨ë˜ì¸µ">ëª¨ë˜ì¸µ</option>
        <option value="ì…€ë£°ë¡œì˜¤ìŠ¤">ì…€ë£°ë¡œì˜¤ìŠ¤</option>
      </select>
      
      <label>ì œê±° íš¨ìœ¨ (%)</label>
      <input type="number" id="efficiency" placeholder="ì˜ˆ: 85">
      
      <label>ë¹„ê³ </label>
      <input type="text" id="note" placeholder="íŠ¹ì´ì‚¬í•­ ë˜ëŠ” ì‹¤í—˜ ì¡°ê±´">
      
      <button onclick="addData()">ë°ì´í„° ì¶”ê°€</button>
      <button onclick="exportCSV()">CSVë¡œ ë‚´ë³´ë‚´ê¸°</button>

      <table id="dataTable">
        <thead>
          <tr>
            <th>ë‚ ì§œ</th>
            <th>í•„í„° ì¬ì§ˆ</th>
            <th>ì œê±° íš¨ìœ¨ (%)</th>
            <th>ë¹„ê³ </th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <section id="chartContainer">
      <h2>ì‹¤í—˜ ê²°ê³¼ ê·¸ë˜í”„</h2>
      <canvas id="efficiencyChart"></canvas>
    </section>

    <section id="imageUpload">
      <h2>ì‹¤í—˜ ì‚¬ì§„ ì—…ë¡œë“œ</h2>
      <input type="file" id="imageInput" multiple accept="image/*">
      <div id="imagePreview"></div>
    </section>
  </main>

  <footer>Â© 2025 MicroFilter Lab | Created by Ham</footer>

  <script>
    const tableBody = document.querySelector("#dataTable tbody");
    const chartCanvas = document.getElementById("efficiencyChart");
    const imageInput = document.getElementById("imageInput");
    const imagePreview = document.getElementById("imagePreview");

    let dataRecords = [];
    let chart;

    function addData() {
      const date = document.getElementById("dateInput").value;
      const filter = document.getElementById("filterType").value;
      const efficiency = document.getElementById("efficiency").value;
      const note = document.getElementById("note").value;

      if (!date || !efficiency) {
        alert("ë‚ ì§œì™€ íš¨ìœ¨ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”!");
        return;
      }

      const newData = { date, filter, efficiency: Number(efficiency), note };
      dataRecords.push(newData);
      updateTable();
      updateChart();
      clearInputs();
    }

    function updateTable() {
      tableBody.innerHTML = "";
      dataRecords.forEach((record) => {
        const row = `<tr>
          <td>${record.date}</td>
          <td>${record.filter}</td>
          <td>${record.efficiency}</td>
          <td>${record.note}</td>
        </tr>`;
        tableBody.innerHTML += row;
      });
    }

    function updateChart() {
      const labels = dataRecords.map(r => r.date);
      const values = dataRecords.map(r => r.efficiency);
      const colors = dataRecords.map(r => {
        if (r.efficiency > 90) return "#0077b6";
        if (r.efficiency > 70) return "#48cae4";
        return "#90e0ef";
      });

      if (chart) chart.destroy();
      chart = new Chart(chartCanvas, {
        type: "bar",
        data: {
          labels,
          datasets: [{
            label: "ì œê±° íš¨ìœ¨ (%)",
            data: values,
            backgroundColor: colors
          }]
        },
        options: {
          scales: {
            y: { beginAtZero: true, max: 100 }
          }
        }
      });
    }

    function clearInputs() {
      document.getElementById("dateInput").value = "";
      document.getElementById("efficiency").value = "";
      document.getElementById("note").value = "";
    }

    function exportCSV() {
      if (dataRecords.length === 0) {
        alert("ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤!");
        return;
      }

      let csvContent = "data:text/csv;charset=utf-8,ë‚ ì§œ,í•„í„° ì¬ì§ˆ,ì œê±° íš¨ìœ¨(%),ë¹„ê³ \n";
      dataRecords.forEach(r => {
        csvContent += `${r.date},${r.filter},${r.efficiency},${r.note}\n`;
      });

      const encodedUri = encodeURI(csvContent);
      const link = document.createElement("a");
      link.setAttribute("href", encodedUri);
      link.setAttribute("download", "microfilter_data.csv");
      document.body.appendChild(link);
      link.click();
      link.remove();
    }

    imageInput.addEventListener("change", function() {
      imagePreview.innerHTML = "";
      Array.from(this.files).forEach(file => {
        const reader = new FileReader();
        reader.onload = e => {
          const img = document.createElement("img");
          img.src = e.target.result;
          imagePreview.appendChild(img);
        };
        reader.readAsDataURL(file);
      });
    });
  </script>
</body>
</html>
